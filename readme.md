# 🚗 交通分配算法软件 Traffic Assignment Algorithm Tool

> 《交通规划原理》课程项目 · 电子科技大学 · 2025

本项目是一个完整的交通分配计算软件，实现了三种经典的交通分配算法，并提供了丰富的可视化功能，可用于教学演示和交通规划分析。

## 📋 项目简介

本软件根据《交通规划原理》课程要求开发，实现了以下核心功能：

- ✅ 读取和解析道路网络文件 (`network.json`) 和出行需求文件 (`demand.json`)
- ✅ 实现三种交通分配算法：
  - 🧮 全有全无分配 (All-or-Nothing Assignment)
  - 📈 增量分配 (Incremental Assignment)
  - ⚖️ Frank-Wolfe 用户均衡分配 (Frank-Wolfe User Equilibrium Assignment)
- ✅ 分配结果定量评估，计算路网总出行时间
- ✅ 分配结果可视化，绘制路网并标注路段流量
- ✅ 多算法比较分析

## 🎯 功能特点

### 核心算法实现
- **全有全无分配**：基于自由流时间的最短路径分配
- **增量分配**：分步加载流量，考虑拥堵效应
- **Frank-Wolfe 用户均衡分配**：迭代优化，达到用户均衡状态
- **自适应步长选择**：采用黄金分割法寻找最优步长

### 可视化功能
- 📊 路网结构可视化（带流量标注）
- 📈 三种算法性能对比分析图
- 🎯 路段流量分布柱状图和热力图
- 🔄 Frank-Wolfe 算法收敛历史图
- 🗺️ OD 需求矩阵可视化
- 🛣️ 路径使用情况分析图

### 实用工具
- 🧭 基于 Dijkstra 算法的最短路径搜索
- 📐 多项式类实现行程时间函数
- 🔍 路径查找和流量分配分析
- 📝 详细的文本输出和结果统计

## 🛠️ 安装与使用

### 环境要求
- Python 3.7+
- 必要库：`matplotlib`, `networkx`, `numpy`

### 安装依赖
```bash
pip install matplotlib networkx numpy
```

### 数据准备
1. 准备路网文件 `network.json`（格式见项目要求）
2. 准备需求文件 `demand.json`（格式见项目要求）
3. 将两个文件放置在程序运行目录下

### 运行程序
```bash
python traffic_assignment.py
```

## 📁 项目结构

```
traffic_assignment/
├── traffic_assignment.py     # 主程序文件
├── network.json              # 路网数据文件
├── demand.json               # 交通需求文件
├── README.md                 # 项目说明文档
└── outputs/                  # 生成的可视化结果
    ├── network_structure.png
    ├── algorithm_comparison.png
    ├── link_flow_distribution.png
    ├── convergence_history.png
    └── ...
```

## 🧩 代码结构

### 主要类说明

#### 1. `Graph` 类
- 实现图数据结构
- Dijkstra 最短路径算法
- 支持多前驱节点的最短路径查找

#### 2. `Polynomial` 类
- 实现多项式运算
- 计算行程时间函数：`t(q) = t₀·(1 + q/cap)²`
- 支持求导、积分和数值计算

#### 3. `RoadNetwork` 类（核心）
- **网络建模**：加载路网和需求数据
- **算法实现**：三种分配算法的完整实现
- **结果分析**：流量统计、时间计算、路径分析
- **可视化**：多种图表生成功能
- **比较工具**：算法性能对比分析

### 关键算法实现

#### Frank-Wolfe 用户均衡算法
```python
def frank_wolfe_equilibrium(self, max_iterations=100, tolerance=1e-4):
    """
    改进的Frank-Wolfe用户均衡分配算法
    1. 初始化：全有全无分配作为起点
    2. 迭代优化：计算辅助流量模式
    3. 步长优化：黄金分割法寻找最优步长
    4. 收敛检查：基于相对对偶间隙
    5. 结果输出：流量分配和路径分析
    """
```

## 📊 测试场景

### 路网结构
- **节点**：A, B, C, D, E, F, G（共7个）
- **路段**：AB, BC, BD, BE, CE, EF, DG, DE（双向，共16条）
- **属性**：长度、通行能力、最大限速

### 交通需求
| 起点 | 终点 | 交通量 (辆/小时) |
|------|------|------------------|
| A    | F    | 2000            |
| F    | A    | 1000            |
| A    | G    | 500             |
| G    | A    | 1000            |
| F    | G    | 1000            |
| G    | F    | 500             |

## 📈 输出结果

### 文本输出
1. **路网基本信息**：节点坐标、路段属性
2. **分配结果**：总出行时间、路段流量、饱和度
3. **路径分析**：使用的路径、流量分配、行程时间
4. **算法对比**：三种算法的性能比较

### 可视化输出
1. **路网结构图**：显示节点位置和路段流量
2. **算法比较图**：包含四个子图的多维度对比
3. **路段流量分布**：柱状图和热力图
4. **收敛历史图**：Frank-Wolfe 算法的迭代过程
5. **OD 矩阵图**：交通需求的热力图
6. **路径使用图**：路径流量和行程时间关系

## 🔍 问题解答

软件能够回答课程要求中的四个关键问题：

1. **不考虑拥堵的最快路径**：基于自由流时间的 Dijkstra 算法
2. **考虑拥堵效应的最快路径**：基于当前流量的最短路径搜索
3. **单 OD 对分配分析**：路段流量、使用路径、行程时间均衡性
4. **全路网分配结果**：总出行时间、流量分布、拥堵状况

## 🏆 算法对比

| 算法 | 总出行时间 | 计算复杂度 | 收敛性 | 适用场景 |
|------|-----------|------------|--------|----------|
| 全有全无 | 较高 | 低 | 不收敛 | 交通需求较低 |
| 增量分配 | 中等 | 中 | 部分收敛 | 中等规模路网 |
| Frank-Wolfe | 最低 | 高 | 收敛 | 大型复杂路网 |

## 📚 参考文献

1. 《交通规划原理》第八章：交通流分配
2. Frank, M., & Wolfe, P. (1956). An algorithm for quadratic programming.
3. Sheffi, Y. (1985). Urban Transportation Networks: Equilibrium Analysis with Mathematical Programming Methods.

## 🧪 测试与验证

软件已通过以下测试：
- ✅ 正确读取 JSON 格式的输入文件
- ✅ 三种算法均能正常运行
- ✅ 流量守恒检查（总分配流量 = 总需求）
- ✅ 用户均衡条件验证（使用路径行程时间接近）
- ✅ 可视化功能正常生成图像文件

---
*最后更新：2025年12月*